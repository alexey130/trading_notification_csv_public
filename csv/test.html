<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Trading Notification (BTC, 60min)</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height: 1.45; }
    .ok { font-weight: 600; }
  </style>
</head>
<body>

{% set tickers = [
  {'name': 'BTC', 'action': 'Trading_notification_BTC_last_week'},
  {'name': 'ETH', 'action': 'Trading_notification_ETH_last_week'},
  {'name': 'XRP', 'action': 'Trading_notification_XRP_last_week'}
] %}

{% set shuffled = tickers | shuffle %}

<h2>Выбранные 2 события</h2>
{% for item in shuffled[:2] %}
  {# берём ВСЕ service_event, фильтруем по action и берём последний #}
  {% set last_event = (events('service_event') | where('action','==',item.action)) | last %}

  <p>
    {{ item.name }}, 
    {{ last_event.pctChange | default('N/A') }}, 
    {{ last_event.priceNow | default('N/A') }}
  </p>
{% endfor %}

</body>
</html>
